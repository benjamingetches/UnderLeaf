<style>
    /* Additional styling */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f5f5f5;
    }
    .card {
      margin: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
      padding: 10px;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .card-title {
      font-size: 1.2em;
      font-weight: bold;
    }
    .card-text {
      max-height: 60px;
      overflow: hidden;
    }
    .button-container {
      text-align: right;
      margin-top: 10px;
    }
    .btn-join {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-join:hover {
      background-color: #45a049;
    }
    .btn-leave {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-leave:hover {
      background-color: #e31b0c;
    }
    .create-form {
      max-width: 400px;
      margin: 20px auto;
      padding: 20px;
      background-color: #ffffff;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
</style>

<h1>Community</h1>

{{!-- Community List --}}
<div class="container">
  <div class="row">
    {{#each data}}
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{name}}</h5>
            <p class="card-text">{{description}}</p>
            <p class="text-muted">Created by: {{created_by}}</p>
            <p class="text-muted">Privacy: {{#if is_private}}Private{{else}}Public{{/if}}</p>

            <div class="button-container">
              {{#if is_member}}
                <button class="btn-leave" onclick="leaveCommunity('{{id}}')">Leave</button>
              {{else}}
                <button class="btn-join" onclick="joinCommunity('{{id}}')">Join</button>
              {{/if}}
            </div>
          </div>
        </div>
      </div>
    {{/each}}
  </div>
</div>

{{!-- Create New Community Form --}}
<div class="create-form">
  <h2>Create a New Community</h2>
  <form action="/create-community" method="POST">
    <div class="form-group">
      <label for="community-name">Community Name</label>
      <input type="text" id="community-name" name="name" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="community-description">Description</label>
      <textarea id="community-description" name="description" class="form-control" rows="3" required></textarea>
    </div>
    <div class="form-group">
      <label for="community-privacy">Privacy</label>
      <select id="community-privacy" name="is_private" class="form-control">
        <option value="false">Public</option>
        <option value="true">Private</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary mt-3">Create Community</button>
  </form>
</div>

<script>
    // JavaScript functions for joining and leaving communities
    async function joinCommunity(communityId) {
      try {
        const response = await fetch(`/join-community/${communityId}`, { method: 'POST' });
        if (response.ok) {
          alert("Joined community successfully!");
          location.reload();
        } else {
          alert("Error joining community.");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("An error occurred while joining the community.");
      }
    }

    async function leaveCommunity(communityId) {
      try {
        const response = await fetch(`/leave-community/${communityId}`, { method: 'POST' });
        if (response.ok) {
          alert("Left community successfully!");
          location.reload();
        } else {
          alert("Error leaving community.");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("An error occurred while leaving the community.");
      }
    }
</script>
