<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Template Page</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
        }

        .card:hover {
            transform: translateY(-5px);
            transition: transform 0.2s;
        }

        .card-text {
            max-height: 60px;
            overflow: hidden;
            white-space: pre-wrap;
            word-break: break-word;
            font-family: monospace;
        }

        .preview-section {
            max-height: 100px;
            overflow: hidden;
            position: relative;
        }

        .preview-section::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(transparent, white);
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Template Page</h1>

        <!-- Placeholder for Main Content -->
        {{#if items.length}}
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            {{#each items}}
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{this.title}}</h5>
                        {{#if this.content}}
                        <p class="card-text small text-muted">
                            {{truncateText this.content 100}}
                        </p>
                        {{/if}}
                        <div class="mt-auto">
                            <a href="/view/{{this.id}}" class="btn btn-secondary btn-sm me-2">View</a>
                            {{#if this.can_edit}}
                            <a href="/edit/{{this.id}}" class="btn btn-primary btn-sm">Edit</a>
                            {{/if}}
                            <button class="btn btn-danger btn-sm delete-item-btn" data-item-id="{{this.id}}">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
        {{else}}
        <p>No items found. <a href="/add-new">Add a new item</a>.</p>
        {{/if}}
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmationModalLabel">Delete Item</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this item?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let itemIdToDelete = null;

            // Delete Item Handler
            document.querySelectorAll('.delete-item-btn').forEach(button => {
                button.addEventListener('click', function () {
                    itemIdToDelete = this.dataset.itemId;
                    $('#deleteConfirmationModal').modal('show');
                });
            });

            // Confirm Delete Button Handler
            document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
                if (itemIdToDelete) {
                    fetch(`/delete-item/${itemIdToDelete}`, {
                        method: 'DELETE',
                    })
                        .then(response => {
                            if (response.ok) {
                                const itemCard = document.querySelector(`.delete-item-btn[data-item-id='${itemIdToDelete}']`).closest('.col');
                                itemCard.remove();
                                $('#deleteConfirmationModal').modal('hide');
                                itemIdToDelete = null;
                            } else {
                                alert('Failed to delete item.');
                            }
                        })
                        .catch(error => {
                            console.error('Error deleting item:', error);
                            alert('An error occurred.');
                        });
                }
            });
        });
    </script>
</body>

</html>
