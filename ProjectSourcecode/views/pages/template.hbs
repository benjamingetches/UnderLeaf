
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <style>
        .template-header {
            background: linear-gradient(135deg, #8cb67d 0%, #accaa1 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        .template-header h1 {
            font-weight: 300;
            margin: 0;
        }

        .template-header p {
            margin: 10px 0 0;
            opacity: 0.9;
        }

        .card {
            border: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-title {
            color: #3c5832;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .card-text {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }

        .template-category {
            font-size: 0.8rem;
            color: #78a567;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .use-template {
            background-color: #8cb67d;
            border: none;
            padding: 0.5rem 1rem;
            transition: background-color 0.2s ease;
        }

        .use-template:hover {
            background-color: #638159;
        }

        .template-features {
            margin-top: 1rem;
            font-size: 0.85rem;
        }

        .template-features ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 0;
        }

        .template-features li {
            margin-bottom: 0.25rem;
            color: #666;
        }

        .template-features li:before {
            content: "â€¢";
            color: #4a90e2;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        .notification {
            position: fixed;
            left: 50%;
            top: 20px;
            transform: translateX(-50%);
            padding: 15px 25px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
            min-width: 300px;
            text-align: center;
        }

        .notification.show {
            opacity: 1;
            z-index: 1500;
        }

        .notification.hide {
            opacity: 0;
            z-index: -1;
        }
    </style>


    <div id="notification" class="notification"></div>

    <div class="template-header">
        <div class="container">
            <h1>LaTeX Templates</h1>
            <p>Choose from our collection of professionally crafted LaTeX templates</p>
        </div>
    </div>

    <div class="container">
        <ul class="nav nav-tabs mb-4" id="templateTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="prebuilt-tab" data-bs-toggle="tab" data-bs-target="#prebuilt" type="button" role="tab">
                    Prebuilt Templates
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="custom-tab" data-bs-toggle="tab" data-bs-target="#custom" type="button" role="tab">
                    My Templates
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="shared-tab" data-bs-toggle="tab" data-bs-target="#shared" type="button" role="tab">
                    Shared With Me
                </button>
            </li>
        </ul>

        <div class="tab-content" id="templateTabsContent">
            <!-- Prebuilt Templates Tab -->
            <div class="tab-pane fade show active" id="prebuilt" role="tabpanel">
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    <div class="col">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column">
                                <div class="template-category">Academic</div>
                                <h5 class="card-title">Math Homework</h5>
                                <p class="card-text">A clean template for mathematics assignments with sections for problems and solutions.</p>
                                <div class="template-features">
                                    <ul>
                                        <li>Problem-solution structure</li>
                                        <li>Math equation support</li>
                                        <li>Section numbering</li>
                                    </ul>
                                </div>
                                <div class="mt-auto">
                                    <button class="btn btn-primary btn-sm use-template w-100" data-template="math_homework">
                                        Use Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column">
                                <div class="template-category">Academic</div>
                                <h5 class="card-title">Research Paper</h5>
                                <p class="card-text">Professional template for academic research papers with standard sections.</p>
                                <div class="template-features">
                                    <ul>
                                        <li>Abstract section</li>
                                        <li>Literature review</li>
                                        <li>APA-style formatting</li>
                                    </ul>
                                </div>
                                <div class="mt-auto">
                                    <button class="btn btn-primary btn-sm use-template w-100" data-template="research_paper">
                                        Use Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column">
                                <div class="template-category">Academic</div>
                                <h5 class="card-title">Lab Report</h5>
                                <p class="card-text">Structured template for scientific lab reports with all necessary sections.</p>
                                <div class="template-features">
                                    <ul>
                                        <li>Experimental method section</li>
                                        <li>Results and discussion</li>
                                        <li>Error analysis</li>
                                    </ul>
                                </div>
                                <div class="mt-auto">
                                    <button class="btn btn-primary btn-sm use-template w-100" data-template="lab_report">
                                        Use Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column">
                                <div class="template-category">Professional</div>
                                <h5 class="card-title">Resume</h5>
                                <p class="card-text">Clean and professional resume template with sections for education, experience, and skills.</p>
                                <div class="template-features">
                                    <ul>
                                        <li>Professional formatting</li>
                                        <li>Section organization</li>
                                        <li>Easy to customize</li>
                                    </ul>
                                </div>
                                <div class="mt-auto">
                                    <button class="btn btn-primary btn-sm use-template w-100" data-template="resume">
                                        Use Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column">
                                <div class="template-category">Presentation</div>
                                <h5 class="card-title">Presentation</h5>
                                <p class="card-text">Simple presentation template with clear sections and bullet points.</p>
                                <div class="template-features">
                                    <ul>
                                        <li>Structured sections</li>
                                        <li>Bullet point formatting</li>
                                        <li>Professional layout</li>
                                    </ul>
                                </div>
                                <div class="mt-auto">
                                    <button class="btn btn-primary btn-sm use-template w-100" data-template="presentation">
                                        Use Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Custom Templates Tab -->
            <div class="tab-pane fade" id="custom" role="tabpanel">
                {{#if userTemplates.length}}
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        {{#each userTemplates}}
                            <div class="col">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body d-flex flex-column">
                                        <div class="template-category">{{this.category}}</div>
                                        <h5 class="card-title">{{this.title}}</h5>
                                        <div class="template-features">
                                            <ul>
                                                <li>Custom template</li>
                                                <li>Created by: {{this.username}}</li>
                                            </ul>
                                        </div>
                                        <div class="mt-auto d-flex gap-2">
                                            <button class="btn btn-primary btn-sm use-template flex-grow-1" 
                                                    data-template="custom_{{this.id}}"
                                                    data-content="{{safeLatex this.content}}"
                                                    data-title="{{this.title}}">
                                                Use Template
                                            </button>
                                            <button class="btn btn-info btn-sm share-template" 
                                                    data-template-id="{{this.id}}"
                                                    data-template-title="{{this.title}}">
                                                <i class="fas fa-share-alt"></i>
                                            </button>
                                            {{#if this.can_edit}}
                                                <button class="btn btn-danger btn-sm delete-template" data-template-id="{{this.id}}">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            {{/if}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {{/each}}
                    </div>
                {{else}}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        You haven't created any custom templates yet. Save a document as a template to see it here!
                    </div>
                {{/if}}

                {{#if sharedTemplates.length}}
                    <h4 class="mt-4 mb-3">Shared Templates</h4>
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        {{#each sharedTemplates}}
                            <!-- Similar card structure as above but for shared templates -->
                        {{/each}}
                    </div>
                {{/if}}
            </div>

            <!-- Shared Templates Tab -->
            <div class="tab-pane fade" id="shared" role="tabpanel">
                {{#if sharedTemplates.length}}
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        {{#each sharedTemplates}}
                            <div class="col">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body d-flex flex-column">
                                        <div class="template-category">{{this.category}}</div>
                                        <h5 class="card-title">{{this.title}}</h5>
                                        <div class="template-features">
                                            <ul>
                                                <li>Shared by: {{this.username}}</li>
                                                <li>{{#if this.can_edit}}Can edit{{else}}View only{{/if}}</li>
                                            </ul>
                                        </div>
                                        <div class="mt-auto">
                                            <button class="btn btn-primary btn-sm use-template w-100" 
                                                    data-template="shared_{{this.id}}"
                                                    data-content="{{safeLatex this.content}}"
                                                    data-title="{{this.title}}">
                                                Use Template
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {{/each}}
                    </div>
                {{else}}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No templates have been shared with you yet.
                    </div>
                {{/if}}
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmationModalLabel">Delete Item</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this item?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Template Modal -->
    <div class="modal fade" id="shareTemplateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Share Template</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="shareTemplateForm">
                        <div class="mb-3">
                            <label class="form-label">Share with:</label>
                            <select class="form-select" id="shareTemplateWith" required>
                                <option value="">Select a friend</option>
                            </select>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="templateCanEdit">
                            <label class="form-check-label" for="templateCanEdit">Allow editing</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmShareTemplate">Share</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Template Confirmation Modal -->
    <div class="modal fade" id="deleteTemplateModal" tabindex="-1" aria-labelledby="deleteTemplateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteTemplateModalLabel">Delete Template</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this template?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteTemplate">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let itemIdToDelete = null;

            // Delete Item Handler
            document.querySelectorAll('.delete-item-btn').forEach(button => {
                button.addEventListener('click', function () {
                    itemIdToDelete = this.dataset.itemId;
                    $('#deleteConfirmationModal').modal('show');
                });
            });

            // Confirm Delete Button Handler
            document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
                if (itemIdToDelete) {
                    fetch(`/delete-item/${itemIdToDelete}`, {
                        method: 'DELETE',
                    })
                        .then(response => {
                            if (response.ok) {
                                const itemCard = document.querySelector(`.delete-item-btn[data-item-id='${itemIdToDelete}']`).closest('.col');
                                itemCard.remove();
                                $('#deleteConfirmationModal').modal('hide');
                                itemIdToDelete = null;
                            } else {
                                showNotification('Failed to delete item.');
                            }
                        })
                        .catch(error => {
                            showNotification('An error occurred.');
                        });
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            const templates = {
                math_homework: `\\documentclass{article}
\\title{Mathematics Assignment}
\\author{Your Name}
\\date{\\today}

\\begin{document}
\\maketitle

\\section{Problem 1}
State your problem here. You can use inline math like $x^2 + y^2 = z^2$ or displayed equations:
$$
    \\int_{0}^{\\infty} e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}
$$

\\section{Solution}
Write your solution here:
\\begin{itemize}
    \\item First step
    \\item Second step
    \\item Conclusion
\\end{itemize}

\\section{Problem 2}
Second problem statement here.

\\section{Solution}
Solution to second problem.

\\end{document}`,
                
                research_paper: `\\documentclass{article}
\\title{Your Research Paper Title}
\\author{Your Name}
\\date{\\today}

\\begin{document}
\\maketitle

\\begin{abstract}
Your abstract goes here. This should be a brief summary of your research paper.
\\end{abstract}

\\section{Introduction}
Introduce your research topic and provide background information.

\\section{Literature Review}
Discuss relevant previous work and theoretical framework.

\\section{Methodology}
Describe your research methods and procedures.

\\section{Results}
Present your findings here.

\\section{Discussion}
Interpret your results and discuss their implications.

\\section{Conclusion}
Summarize your findings and suggest future research directions.

\\end{document}`,

                lab_report: `\\documentclass{article}
\\title{Laboratory Report:\\\\Experiment Title}
\\author{Your Name}
\\date{\\today}

\\begin{document}
\\maketitle

\\section{Abstract}
Brief summary of the experiment and findings.

\\section{Introduction}
\\subsection{Objective}
State the purpose of the experiment.

\\section{Experimental Method}
\\begin{itemize}
    \\item Equipment 1
    \\item Equipment 2
\\end{itemize}

\\section{Results}
Present your data and observations here.

\\section{Discussion}
Analysis of results and sources of error.

\\section{Conclusion}
Summary of findings and conclusions.

\\end{document}`,

                resume: `\\documentclass{article}
\\title{Your Name}
\\date{}

\\begin{document}
\\maketitle

\\section{Education}
\\begin{itemize}
    \\item University Name (20XX -- 20XX)
    \\item Degree Name
    \\item Major: Your Major
\\end{itemize}

\\section{Experience}
\\begin{itemize}
    \\item Company Name (Dates)
    \\item Job Title
    \\item Achievement 1
    \\item Achievement 2
\\end{itemize}

\\section{Skills}
\\begin{itemize}
    \\item Technical: Skill 1, Skill 2, Skill 3
    \\item Languages: Language 1, Language 2
    \\item Tools: Tool 1, Tool 2
\\end{itemize}

\\end{document}`,

                presentation: `\\documentclass{article}
\\title{Presentation Title}
\\author{Your Name}
\\date{\\today}

\\begin{document}
\\maketitle

\\section{Introduction}
\\begin{itemize}
    \\item Point 1
    \\item Point 2
    \\item Point 3
\\end{itemize}

\\section{Main Content}
Key information here

\\section{Important Points}
\\begin{itemize}
    \\item Key point 1
    \\item Key point 2
    \\item Key point 3
\\end{itemize}

\\section{Conclusion}
\\begin{itemize}
    \\item Summary point 1
    \\item Summary point 2
    \\item Future work
\\end{itemize}

\\end{document}`
            };

            document.querySelectorAll('.use-template').forEach(button => {
                button.addEventListener('click', function() {
                    const templateName = this.dataset.template;
                    const templateContent = this.dataset.content;
                    const templateTitle = this.dataset.title;
                    
                    if (templateContent) {
                        // This handles user-created templates
                        sessionStorage.setItem('template_content', templateContent);
                        sessionStorage.setItem('template_title', templateTitle);
                        window.location.href = '/editor?template=true';
                    } else if (templates[templateName]) {
                        // This handles prebuilt templates
                        sessionStorage.setItem('template_content', templates[templateName]);
                        sessionStorage.setItem('template_title', templateName);
                        window.location.href = '/editor?template=true';
                    } else {
                        console.error('No template content found');
                    }
                });
            });
        });

        let templateToDelete = null;
        const deleteTemplateModal = new bootstrap.Modal(document.getElementById('deleteTemplateModal'));

        document.querySelectorAll('.delete-template').forEach(button => {
            button.addEventListener('click', function() {
                templateToDelete = this;
                deleteTemplateModal.show();
            });
        });

        document.getElementById('confirmDeleteTemplate').addEventListener('click', async function() {
            if (templateToDelete) {
                const templateId = templateToDelete.dataset.templateId;
                try {
                    const response = await fetch(`/delete-template/${templateId}`, {
                        method: 'DELETE'
                    });
                    const data = await response.json();
                    if (data.success) {
                        showNotification('Template deleted successfully');
                        templateToDelete.closest('.col').remove();
                        deleteTemplateModal.hide();
                    } else {
                        throw new Error(data.error);
                    }
                } catch (error) {
                    showNotification('Error deleting template: ' + error.message);
                }
                templateToDelete = null;
            }
        });

        // Add sharing functionality
        document.querySelectorAll('.share-template').forEach(button => {
            button.addEventListener('click', async function() {
                const templateId = this.dataset.templateId;
                const templateTitle = this.dataset.templateTitle;

                try {
                    // Fetch friends list
                    const response = await fetch('/get-friends-for-sharing');
                    const friends = await response.json();

                    // Populate the select dropdown
                    const select = document.getElementById('shareTemplateWith');
                    select.innerHTML = '<option value="">Select a friend</option>';
                    friends.forEach(friend => {
                        select.innerHTML += `<option value="${friend.friend_username}">${friend.friend_username}</option>`;
                    });

                    // Show the modal
                    const modal = new bootstrap.Modal(document.getElementById('shareTemplateModal'));
                    modal.show();

                    // Handle share confirmation
                    document.getElementById('confirmShareTemplate').onclick = async () => {
                        const shareWith = document.getElementById('shareTemplateWith').value;
                        const canEdit = document.getElementById('templateCanEdit').checked;

                        if (!shareWith) {
                            showNotification('Please select a friend to share with.');
                            return;
                        }

                        try {
                            const shareResponse = await fetch('/share-template', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    templateId,
                                    shareWith,
                                    canEdit
                                }),
                            });

                            const result = await shareResponse.json();

                            if (result.success) {
                                showNotification('Template shared successfully!');
                                modal.hide();
                                window.location.reload();
                            } else {
                                throw new Error(result.error || 'Failed to share template');
                            }
                        } catch (error) {
                            showNotification('Error sharing template: ' + error.message);
                        }
                    };
                } catch (error) {
                    showNotification('Error loading friends list: ' + error.message);
                }
            });
        });

        // Clean up modal when hidden
        document.getElementById('shareTemplateModal').addEventListener('hidden.bs.modal', function () {
            document.getElementById('shareTemplateWith').value = '';
            document.getElementById('templateCanEdit').checked = false;
        });

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    notification.classList.remove('show', 'hide');
                }, 500);
            }, 3000);
        }

    </script>

