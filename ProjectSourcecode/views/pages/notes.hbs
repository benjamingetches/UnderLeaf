<style>
    /* Additional styling */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f5f5f5;
    }
    .card:hover {
      transform: translateY(-5px);
      transition: transform 0.2s;
    }
    .card-text {
      max-height: 60px;
      overflow: hidden;
    }
    .card-text {
        white-space: pre-wrap;
        word-break: break-word;
        font-family: monospace;
    }
    
    .latex-preview {
        max-height: 100px;
        overflow: hidden;
        position: relative;
    }
    
    .latex-preview::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 20px;
        background: linear-gradient(transparent, white);
    }
</style>



<div class="container mt-5 bg1">
    <h1 class="mb-4">Your Notes</h1>
    {{#if notes.length}}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {{#each notes}}
      <div class="col">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{safeLatex this.title}}</h5>
            {{#if this.content}}
            <p class="card-text small text-muted">
                {{truncateLatex this.content 100}}
            </p>
            {{/if}}
            <p class="card-text text-muted">
              {{#if_eq this.access_type "Shared"}}
                  Shared by: {{this.username}}
                  {{#if this.can_edit}}
                      (Can Edit)
                  {{else}}
                      (Read Only)
                  {{/if}}
              {{/if_eq}}
            </p>
            <div class="mt-auto">
              {{#if can_read}}
                  <a href="/edit-note/{{this.id}}" class="btn btn-secondary btn-sm me-2 {{#unless can_edit}}disabled{{/unless}}">
                      {{#if can_edit}}Edit{{else}}View{{/if}}
                  </a>
                  {{#if_eq access_type "Owner"}}
                      <button class="btn btn-danger btn-sm delete-note-btn" data-note-id="{{this.id}}">Delete</button>
                  {{/if_eq}}
              {{/if}}
            </div>
          </div>
        </div>
      </div>
      {{/each}}
    </div>
    {{else}}
    <p>You have no saved notes. <a href="/editor">Create a new note</a>.</p>
    {{/if}}
</div>
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmationModalLabel">Delete Note</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <!-- Modal Body -->
      <div class="modal-body">
        Are you sure you want to delete this note?
      </div>
      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    let noteIdToDelete = null; // Variable to store the note ID to delete

    const deleteButtons = document.querySelectorAll('.delete-note-btn');
    deleteButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        noteIdToDelete = this.dataset.noteId;

        // Show the Bootstrap modal
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
        deleteModal.show();
      });
    });

    // Handle the confirm delete button click
    document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
      if (noteIdToDelete) {
        fetch(`/delete-note/${noteIdToDelete}`, {
          method: 'DELETE',
        })
        .then(response => {
          if (response.ok) {
            // Remove the note's card from the DOM
            const noteCard = document.querySelector(`.delete-note-btn[data-note-id='${noteIdToDelete}']`).closest('.col');
            noteCard.remove();

            // Hide the modal
            const deleteModalEl = document.getElementById('deleteConfirmationModal');
            const deleteModal = bootstrap.Modal.getInstance(deleteModalEl);
            deleteModal.hide();

            // Reset the note ID
            noteIdToDelete = null;
          } else {
            alert('Failed to delete note.');
          }
        })
        .catch(error => {
          console.error('Error deleting note:', error);
          alert('An error occurred.');
        });
      }
    });
  });
</script>
