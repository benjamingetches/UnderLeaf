<div class="community-container">
    {{#if community}}
        <!-- Community Header -->
        <div class="community-header">
            <h1>{{community.name}}</h1>
            <p class="description">{{community.description}}</p>
            {{#if community.Community_picture_url}}
                <img src="{{community.Community_picture_url}}" alt="Community Picture" class="community-image">
            {{/if}}
            <div class="stats">
                <span class="member-count">{{community.member_count}} members</span>
                {{#if isAdmin}}
                    {{#if community.is_private}}
                        <div class="access-code-container">
                            <span class="access-code-label">Access Code:</span>
                            <span class="access-code">{{community.access_code}}</span>
                            <button class="btn btn-secondary copy-btn" onclick="copyAccessCode('{{community.access_code}}')">
                                Copy Code
                            </button>
                        </div>
                    {{/if}}
                {{/if}}
            </div>
        </div>

        <!-- Community Actions -->
        <div class="community-actions">
            {{#if isMember}}
                <form action="/community/{{community.community_id}}/leave" method="POST" class="action-form">
                    <button type="submit" class="btn btn-danger">Leave Community</button>
                </form>
            {{else}}
                <form action="/community/{{community.community_id}}/join" method="POST" class="action-form">
                    <button type="submit" class="btn btn-primary">Join Community</button>
                </form>
            {{/if}}
            
            {{#if isAdmin}}
                <button class="btn btn-secondary" onclick="openManageModal()">Manage Community</button>
            {{/if}}
        </div>

        <!-- Main Content Area -->
        <div class="community-content">
            <!-- Members Section -->
            <div class="members-panel">
                <h3>Members</h3>
                <ul class="members-list">
                    {{#each members}}
                        <li class="member-item">
                            <span class="username">{{this.username}}</span>
                            {{#if this.is_admin}}
                                <span class="admin-badge">Admin</span>
                            {{/if}}
                        </li>
                    {{/each}}
                </ul>
            </div>

            <!-- Chat Section -->
            {{#if isMember}}
                <div class="chat-panel">
                    <h3>Community Chat</h3>
                    <div class="messages-container">
                        {{#each messages}}
                            <div class="message">
                                <div class="message-header">
                                    <strong>{{this.username}}</strong>
                                    <span class="timestamp">{{this.sent_at}}</span>
                                </div>
                                <div class="message-content">
                                    {{this.content}}
                                </div>
                            </div>
                        {{/each}}
                    </div>
                    <form id="messageForm" class="message-form">
                        <input type="text" id="messageInput" placeholder="Type your message..." required>
                        <button type="submit" class="btn btn-primary">Send</button>
                    </form>
                </div>
            {{/if}}
        </div>
    {{else}}
        <p>Community not found.</p>
    {{/if}}
</div>

<style>
    .community-container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
    }

    .community-header {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .community-image {
        max-width: 200px;
        border-radius: 8px;
        margin: 10px 0;
    }

    .description {
        color: #666;
        margin: 10px 0;
    }

    .community-content {
        display: grid;
        grid-template-columns: 250px 1fr;
        gap: 20px;
    }

    .members-panel, .chat-panel {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #ddd;
    }

    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 0 5px;
    }

    .btn-primary { background-color: #0073b1; color: white; }
    .btn-danger { background-color: #dc3545; color: white; }
    .btn-secondary { background-color: #6c757d; color: white; }

    .messages-container {
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 15px;
    }

    .message {
        padding: 10px;
        border-bottom: 1px solid #eee;
    }

    .message-form {
        display: flex;
        gap: 10px;
    }

    .message-form input {
        flex-grow: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .admin-badge {
        background: #73cf73;
        color: white;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.8em;
    }

    .access-code-container {
        margin-top: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }

    .access-code-label {
        font-weight: bold;
        color: #666;
    }

    .access-code {
        font-family: monospace;
        background-color: #fff;
        padding: 4px 8px;
        border-radius: 3px;
        border: 1px solid #ddd;
    }

    .copy-btn {
        padding: 4px 8px;
        font-size: 0.9em;
    }
</style>

<script>
function copyAccessCode(code) {
    navigator.clipboard.writeText(code)
        .then(() => {
            // Create a temporary notification
            const notification = document.createElement('div');
            notification.textContent = 'Access code copied!';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background-color: #4CAF50;
                color: white;
                padding: 10px 20px;
                border-radius: 4px;
                z-index: 1000;
            `;
            document.body.appendChild(notification);

            // Remove the notification after 2 seconds
            setTimeout(() => {
                notification.remove();
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy access code:', err);
        });
}
</script>